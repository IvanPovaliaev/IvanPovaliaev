using System;
using System.Collections.Generic;
using System.Linq;

namespace GeniyIdiotConsoleApp
{
    internal class Program
    {        
        static void Main()
        {
            var user = ConsoleManager.CreateUser();
            var menuOptions = new List<MenuOption>
            {
                new ("Начать тест", ConsoleManager.StartTest),
                new ("Таблица результатов", () =>
                    {
                        ConsoleManager.ShowResults();
                        Console.WriteLine("\nХотите очистить таблицу результатов? (Введите да/нет)");

                        if (ConsoleManager.GetUserYesOrNoAnswer())
                        {
                            UserStorage.ClearUsersResults();
                            Console.Clear();
                        }
                    }),
                new ("Список вопросов", () =>
                    {
                        while(true)
                        {
                            ConsoleManager.ShowQuestions();
                            Console.WriteLine("\nВыберите действие");
                            var questionsOptions = new List<MenuOption>
                            {
                                new ("Добавить свой вопрос", ConsoleManager.AddQuestion),
                                new ("Удалить вопрос", ConsoleManager.DeleteQuestion),
                                new ("Вернуться в меню", () => {})
                            }

                            ConsoleManager
                                .ShowMenuOptions(questionsOptions.Select(option => option.MenuDescription));
                            if (ConsoleManager.ChoiceMenuOption(questionOptions) == questionsOptions.Count - 1) break;
                        }
                    }),
                new ("Выход", () => Environment.Exit(0))
            };

            while (true)
            {
                Console.Clear();
                ConsoleManager.ShowMainMenu(user, menuOptions.Select(option => option.MenuDescription));
                Console.WriteLine("\nПожалуйста, введите номер пункта, куда хотите перейти");

                ConsoleManager.ChoiceMenuOption(menuOptions);

                var userChoice = ConsoleManager.GetUserInt32Answer(1, menuOptions.Count);

                if (menuOptions[userChoice - 1].Option is Action menuOption)
                {
                    menuOption();
                    continue;
                }
                if (menuOptions[userChoice - 1].Option is Action<User> menuOptionUser)
                {
                    menuOptionUser(user);
                    continue;
                }                
            }
        }
        public static string GetDiagnosis(int countRigthAnswers, int countQuestions)
        {
            var diagnoses = new string[6];
            diagnoses[0] = "Идиот";
            diagnoses[1] = "Кретин";
            diagnoses[2] = "Дурак";
            diagnoses[3] = "Нормальный";
            diagnoses[4] = "Талант";
            diagnoses[5] = "Гений";

            var percentRightAnswers = 100 * countRigthAnswers / countQuestions;
            if (percentRightAnswers < 10) return diagnoses[0];
            if (percentRightAnswers < 30) return diagnoses[1];
            if (percentRightAnswers < 50) return diagnoses[2];
            if (percentRightAnswers < 70) return diagnoses[3];
            if (percentRightAnswers < 90) return diagnoses[4];
            return diagnoses[5];
        }
    }
}
